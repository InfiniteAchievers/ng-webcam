!function(){"use strict";var e=angular.module("ngWebcam",[]);e.directive("ngWebcam",[function(){function e(e){if(e.ngWebcam.destWidth||(e.ngWebcam.destWidth=t.video.clientWidth),e.ngWebcam.destHeight||(e.ngWebcam.destHeight=t.video.clientHeight),e.ngWebcam.constraints&&"object"==typeof e.ngWebcam.constraints&&(t.constraints=e.ngWebcam.constraints),e.ngWebcam.flipHoriz||(e.ngWebcam.flipHoriz=!1,t.flipFlag=!1),e.ngWebcam.imageFormat||(e.ngWebcam.imageFormat="jpeg"),e.ngWebcam.imageQuality){if(isNaN(e.ngWebcam.imageQuality)||e.ngWebcam.imageQuality>100||e.ngWebcam.imageQuality<0)return alert("imageQuality option is not valid"),!1}else e.ngWebcam.imageQuality=90;return e.ngWebcam.flip=function(a){var i=t.video.style;e.ngWebcam.flipHoriz=!e.ngWebcam.flipHoriz,a&&(e.ngWebcam.flipHoriz=a),e.ngWebcam.flipHoriz?(i.webkitTransform="scaleX(-1)",i.mozTransform="scaleX(-1)",i.msTransform="scaleX(-1)",i.oTransform="scaleX(-1)",i.transform="scaleX(-1)",i.filter="FlipH",i.msFilter="FlipH"):(i.webkitTransform="scaleX(1)",i.mozTransform="scaleX(1)",i.msTransform="scaleX(1)",i.oTransform="scaleX(1)",i.transform="scaleX(1)",i.filter="",i.msFilter=""),t.flipFlag=!0},e.ngWebcam.flipHoriz&&e.ngWebcam.flip(!0),!0}function a(a,i,n){function o(){t.loaded||t.mediaDevices.getUserMedia({audio:!1,video:t.constraints}).then(function(e){t.video.src=window.URL.createObjectURL(e)||e,t.stream=e,t.loaded=t.live=!0,a.ngWebcam.onload&&"function"==typeof a.ngWebcam.onload&&a.ngWebcam.onload(),a.ngWebcam.onlive&&"function"==typeof a.ngWebcam.onlive&&a.ngWebcam.onlive()})["catch"](function(e){console.log(e)})}function c(){var e=document.createElement("canvas");e.width=a.ngWebcam.destWidth,e.height=a.ngWebcam.destHeight;var i=e.getContext("2d");a.ngWebcam.flipHoriz&&(i.translate(a.ngWebcam.destWidth,0),i.scale(-1,1)),i.drawImage(t.video,0,0,e.width,e.height);var n=e.toDataURL("image/"+a.ngWebcam.imageFormat,a.ngWebcam.imageQuality/100);return i=null,e=null,n}function r(){a.ngWebcam.onstream(c()),a.$parent.$$phase||a.$parent.$apply(),setTimeout(r,0)}function m(e){var a=e.getContext("2d");t.flipFlag&&(a.translate(e.width,0),a.scale(-1,1),t.flipFlag=!1),a.drawImage(t.video,0,0,e.width,e.height),setTimeout(function(){m(e)},0)}t.init(),e(a)&&(a.ngWebcam.snap=function(e){e&&"function"==typeof e&&e(c())},a.ngWebcam.onstream&&"function"==typeof a.ngWebcam.onstream&&r(),a.ngWebcam.stop=function(){if(t.userMedia){if(t.stream)if(t.stream.getVideoTracks){var e=t.stream.getVideoTracks();e&&e[0]&&e[0].stop&&e[0].stop()}else t.stream.stop&&t.stream.stop();t.stream=null,t.loaded=t.live=!1,t.video.src=""}},a.ngWebcam.start=function(){o()},a.ngWebcam.liveCanvas&&m(a.ngWebcam.liveCanvas),a.ngWebcam.startOnload&&o())}function i(e,a){return t.video=document.createElement("video"),t.video.setAttribute("autoplay","autoplay"),t.video.style.width="100%",t.video.style.height="100%",t.video}var t={loaded:!1,live:!1,constraints:{},userMedia:!0,flipFlag:!0,init:function(){t.mediaDevices=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices:navigator.mozGetUserMedia||navigator.webkitGetUserMedia?{getUserMedia:function(e){return new Promise(function(a,i){(navigator.mozGetUserMedia||navigator.webkitGetUserMedia).call(navigator,e,a,i)})}}:null,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,t.userMedia=t.userMedia&&!!t.mediaDevices&&!!window.URL}};return{restrict:"A",scope:{ngWebcam:"="},link:a,template:i}}])}();